on:
  workflow_dispatch:
    inputs:
      iam:
        description: 'iam'
        required: true
      secret:
        description: 'secret'
        required: true
      network:
        description: 'network'
        required: true
      data:
        description: 'data'
        required: true
      compute:
        description: 'compute'
        required: true
      shared:
        description: 'shared'
        required: true
env:
  GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
  GCS_TERRAFORM_REMOTE_STATE_BUCKET: ${{ secrets.GCP_TERRAFORM_REMOTE_STATE_BUCKET }}
jobs:
  gcloud_projects_delete:
    runs-on: ubuntu-latest
    steps:
      - name: run checkout
        uses: actions/checkout@v2
      - name: run setup GITHUB_ENV
        working-directory: ./bash/github-actions
        run: |
          IAM=${{ github.event.inputs.iam }}
          SECRET=${{ github.event.inputs.secret }}
          NETWORK=${{ github.event.inputs.network }}
          DATA=${{ github.event.inputs.data }}
          COMPUTE=${{ github.event.inputs.compute }}
          SHARED=${{ github.event.inputs.shared }}
          source setup_github_env.sh
      - name: run setup gcloud
        uses: google-github-actions/setup-gcloud@master
        with:
          service_account_key: ${{ env.GCP_SA_KEY }}
          export_default_credentials: true
      - name: run gcloud components install
        run: gcloud components install alpha
      - name: run gcloud_projects_delete.sh
        working-directory: ./bash/gcloud
        run: ./projects_delete.sh
