#!/bin/bash
function run_terragrunt_command() {
  terragrunt_cli_flags=($(echo "${TERRAGRUNT_CLI_FLAGS}" | jq -rc '@sh' | tr -d \'\"))
  command=(
    terragrunt
    "${TERRAGRUNT_COMMAND}"
    "${terragrunt_cli_flags[@]}"
  )
  "${command[@]}"
}

export TERRAGRUNT_CLI_FLAGS='[
    "--terragrunt-include-dir global/terraform/**/**",
    "--terragrunt-include-dir global/iam/**/**",
    "--terragrunt-include-dir global/secret/**/**",
    "--terragrunt-include-dir global/artifact/**/**",
    "--terragrunt-include-dir global/network/**/**",
    "--terragrunt-include-dir global/data/**/**",
    "--terragrunt-include-dir global/compute/**/**",
    "--terragrunt-include-dir global/kubeflow/**/**",
    "--terragrunt-include-dir us-central1/network/**/**",
    "--terragrunt-include-dir us-central1/data/**/**",
    "--terragrunt-include-dir us-central1/compute/**/**",
    "--terragrunt-include-dir us-central1/kubeflow/**/**"
]'
export TERRAGRUNT_COMMAND="run-all apply"
export TERRAGRUNT_WORKING_DIR="terragrunt/live/gcs/non-prod"
export TF_INPUT="false"
export TF_LOG="JSON"
export TF_LOG_FILE="${GITHUB_WORKSPACE}/logs.txt"
export TGENV_AUTO_INSTALL="true"
